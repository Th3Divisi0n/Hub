<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Subspace Login</title>
  <style>
    :root {
      --bg: #0b0b10;
      --panel: #151322;
      --accent: #6b3fa0;
      --accent-2: #9b5de5;
      --text: #e6e1ee;
      --muted: #a99fbd;
      --error: #ff6473;
      --success: #36d399;
      --outline: rgba(155,93,229,0.35);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(1200px 800px at 80% -10%, rgba(155,93,229,0.12), transparent 60%),
                  radial-gradient(1000px 700px at 10% 110%, rgba(107,63,160,0.20), transparent 60%),
                  var(--bg);
      display: grid;
      place-items: center;
      padding: 2rem;
    }
    .card {
      width: 100%;
      max-width: 440px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent 60%), var(--panel);
      border: 1px solid var(--outline);
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
      overflow: hidden;
      backdrop-filter: blur(6px);
    }
    .header {
      padding: 1.25rem 1.25rem 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .logo {
      height: 28px; width: 28px; border-radius: 8px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      box-shadow: 0 6px 18px rgba(155,93,229,0.45);
    }
    h1 {
      font-size: 1.1rem;
      margin: 0;
      letter-spacing: .4px;
      color: var(--text);
    }
    .body { padding: 1.25rem; }
    .tabs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: .5rem;
      background: rgba(255,255,255,0.03);
      padding: .35rem;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.06);
      margin-bottom: 1rem;
    }
    .tab {
      text-align: center;
      padding: .6rem .8rem;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
      font-weight: 600;
      color: var(--muted);
      transition: transform .08s ease, color .2s ease, background .2s ease, box-shadow .2s ease;
    }
    .tab.active {
      color: var(--text);
      background: linear-gradient(180deg, rgba(155,93,229,0.22), rgba(107,63,160,0.18));
      box-shadow: 0 6px 20px rgba(155,93,229,0.28);
      border: 1px solid rgba(155,93,229,0.45);
      transform: translateY(-1px);
    }
    .row { display: grid; gap: .5rem; margin-bottom: .9rem; }
    label {
      font-size: .85rem;
      color: var(--muted);
      letter-spacing: .3px;
    }
    input {
      width: 100%;
      padding: .85rem .95rem;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      outline: none;
      transition: box-shadow .2s ease, border-color .2s ease, background .2s ease;
    }
    input:focus {
      border-color: var(--accent-2);
      box-shadow: 0 0 0 4px rgba(155,93,229,0.18);
      background: rgba(255,255,255,0.08);
    }
    .btn {
      width: 100%;
      padding: .9rem 1rem;
      border-radius: 12px;
      border: 1px solid rgba(155,93,229,0.55);
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: white;
      font-weight: 700;
      letter-spacing: .3px;
      cursor: pointer;
      transition: transform .06s ease, filter .2s ease, box-shadow .2s ease;
      box-shadow: 0 10px 30px rgba(155,93,229,0.4);
    }
    .btn:hover { filter: brightness(1.05); }
    .btn:active { transform: translateY(1px); }
    .hint {
      font-size: .8rem;
      color: var(--muted);
      margin: .5rem 0 0;
      text-align: center;
    }
    .msg {
      border-radius: 12px;
      padding: .8rem .9rem;
      line-height: 1.35;
      display: none;
      margin-bottom: 1rem;
    }
    .msg.show { display: block; }
    .msg.error { background: rgba(255,100,115,.1); border: 1px solid rgba(255,100,115,.3); color: #ffd3d8; }
    .msg.ok    { background: rgba(54,211,153,.1); border: 1px solid rgba(54,211,153,.3); color: #c9ffe9; }
    .footer {
      padding: .9rem 1.25rem 1.25rem;
      color: var(--muted);
      border-top: 1px solid rgba(255,255,255,0.06);
      font-size: .78rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="header">
      <div class="logo"></div>
      <h1>Subspace Secure Portal</h1>
    </div>
    <div class="body">
      <div id="message" class="msg"></div>

      <div class="tabs">
        <div id="tab-login" class="tab active">Log in</div>
        <div id="tab-signup" class="tab">Create account</div>
      </div>
<!-- ðŸ”¹ Signup Form -->
<form id="signup-form" style="display:none;">
  <div class="row">
    <label for="signup-email">Email</label>
    <input id="signup-email" type="email" placeholder="you@example.com" autocomplete="email"/>
  </div>
  <div class="row">
    <label for="signup-username">User</label>
    <input id="signup-username" placeholder="choose a username" autocomplete="username"/>
  </div>
  <div class="row">
    <label for="signup-password">Password</label>
    <input id="signup-password" type="password" placeholder="min 6 characters" autocomplete="new-password"/>
  </div>
  <button class="btn" type="submit">Create account</button>
  <p class="hint">You will be shown your unique Binary Code once after account creation.</p>
</form>

<!-- ðŸ”¹ Login Form -->
<form id="login-form">
  <div class="row">
    <label for="login-email">Email</label>
    <input id="login-email" type="email" placeholder="you@example.com" autocomplete="email"/>
  </div>
  <div class="row">
    <label for="login-username">User</label>
    <input id="login-username" placeholder="e.g. test" autocomplete="username"/>
  </div>
  <div class="row">
    <label for="login-password">Password</label>
    <input id="login-password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password"/>
  </div>
  <div class="row">
    <label for="login-bincode">Binary Code</label>
    <input id="login-bincode" placeholder="e.g. 001010000010" autocomplete="one-time-code"/>
  </div>
  <button class="btn" type="submit">Enter</button>
  <p class="hint">Your Binary Code is part of sign-in for extra security.</p>
</form>


  <!-- Firebase SDKs (Compat for simplicity) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCb3_IKXpkqVH_e-4dnI6EMqz0isN4ybQ4",
      authDomain: "subspacelogin-2e0ac.firebaseapp.com",
      projectId: "subspacelogin-2e0ac",
      storageBucket: "subspacelogin-2e0ac.firebasestorage.app",
      messagingSenderId: "399796906077",
      appId: "1:399796906077:web:b5b770049a41fcbcb5c5b4",
      measurementId: "G-G2RV0FZPR2"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const msg = document.getElementById('message');
    function showMsg(text, type = 'ok') {
      msg.textContent = text;
      msg.className = 'msg show ' + (type === 'error' ? 'error' : 'ok');
    }
    function clearMsg() {
      msg.className = 'msg';
      msg.textContent = '';
    }

    const tabLogin = document.getElementById('tab-login');
    const tabSignup = document.getElementById('tab-signup');
    const formLogin = document.getElementById('login-form');
    const formSignup = document.getElementById('signup-form');
    tabLogin.addEventListener('click', () => {
      tabLogin.classList.add('active'); tabSignup.classList.remove('active');
      formLogin.style.display = ''; formSignup.style.display = 'none';
      clearMsg();
    });
    tabSignup.addEventListener('click', () => {
      tabSignup.classList.add('active'); tabLogin.classList.remove('active');
      formSignup.style.display = ''; formLogin.style.display = 'none';
      clearMsg();
    });

    const BINARY_LENGTH = 12;
    function randomBinary(n = BINARY_LENGTH) {
      let s = '';
      for (let i = 0; i < n; i++) s += Math.random() < 0.5 ? '0' : '1';
      return s;
    }

    async function reserveUniqueBinary(uid) {
      for (let attempts = 0; attempts < 50; attempts++) {
        const candidate = randomBinary();
        const ref = db.collection('binaryCodes').doc(candidate);
        try {
          await db.runTransaction(async (tx) => {
            const snap = await tx.get(ref);
            if (snap.exists) throw new Error('taken');
            tx.set(ref, { uid, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
          });
          return candidate;
        } catch (e) {
          if (e.message !== 'taken') throw e;
        }
      }
      throw new Error('Could not allocate a unique code.');
    }

    const elSignupUser = document.getElementById('signup-username');
    const elSignupPass = document.getElementById('signup-password');
    const elSignupEmail = document.getElementById('signup-email');

formSignup.addEventListener('submit', async (e) => {
  e.preventDefault();
  clearMsg();
  const email = (elSignupEmail.value || '').trim();
  const username = (elSignupUser.value || '').trim();
  const password = elSignupPass.value || '';

  if (!email) return showMsg('Please enter an email.', 'error');
  if (!username) return showMsg('Please enter a username.', 'error');
  if (password.length < 6) return showMsg('Password must be at least 6 characters.', 'error');

  try {
    const cred = await auth.createUserWithEmailAndPassword(email, password);
    const uid = cred.user.uid;
    const binaryCode = await reserveUniqueBinary(uid);
    await db.collection('users').doc(uid).set({
      email, username, binaryCode,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    showMsg(`Account Created Successfully! Your Binary Code is: ${binaryCode}`, 'ok');
    await auth.signOut();
  } catch (err) {
    showMsg(err.message || String(err), 'error');
  }
});

    const elLoginUser = document.getElementById('login-username');
    const elLoginPass = document.getElementById('login-password');
    const elLoginBin  = document.getElementById('login-bincode');
    const elLoginEmail = document.getElementById('login-email');

   formLogin.addEventListener('submit', async (e) => {
  e.preventDefault();
  clearMsg();

  const email = (elLoginEmail.value || '').trim();
  const username = (elLoginUser.value || '').trim();
  const password = elLoginPass.value || '';
  const binInput = (elLoginBin.value || '').trim();

  if (!email) return showMsg('Please enter your email.', 'error');
  if (!username) return showMsg('Please enter your username.', 'error');
  if (!password) return showMsg('Please enter a password.', 'error');
  if (!binInput) return showMsg('Please enter your Binary Code.', 'error');

  try {
    const cred = await auth.signInWithEmailAndPassword(email, password);
    const uid = cred.user.uid;

    const userDoc = await db.collection('users').doc(uid).get();
    if (!userDoc.exists) {
      await auth.signOut();
      return showMsg('Account data not found.', 'error');
    }

    const { username: storedUser, binaryCode } = userDoc.data();

    if (username !== storedUser) {
      await auth.signOut();
      return showMsg('Username does not match this account.', 'error');
    }
    if (binInput !== binaryCode) {
      await auth.signOut();
      return showMsg('Invalid Binary Code.', 'error');
    }

    showMsg('Login successful! Redirecting...', 'ok');
    setTimeout(() => {
      window.location.href = "https://yourwebsite.com";
    }, 1500);
  } catch (err) {
    showMsg(err.message || String(err), 'error');
  }
});

  </script>
</body>
</html>
